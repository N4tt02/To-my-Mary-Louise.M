<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To My Mary Louise</title>
  
<link rel="icon" type="image/png" sizes="32x32" href="6003502.png">
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  height: 100vh;
  background: #f4f4f9;
  overflow: hidden;
  position: relative;
  font-family: 'Merriweather', serif;
}

h1,h2,h3 { font-family: 'Great Vibes', cursive; }

/* Envelope */
.envelope-container {
  position: absolute;
  width: 280px;
  height: 200px;
  perspective: 1000px;
  cursor: pointer;
  transition: transform 0.4s ease, left 0.4s ease, top 0.4s ease;
  z-index: 10;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}
.envelope-container.open { transform: translate(-50%, -50%) scale(1.25); }

.envelope {
  position: relative;
  width: 100%;
  height: 100%;
  background: #5a0000;
  border-radius: 6px;
  border: 2px solid #330000;
  box-shadow: 0 6px 15px rgba(0,0,0,0.25);
  overflow: hidden;
}
.flap {
  position: absolute;
  top: -102%;
  left: 51%;
  width: 200%;
  height: 195px;
  transform: translateX(-50%) rotateX(180deg);
  transform-origin: bottom center;
  background: #c0003d;
  clip-path: polygon(0 100%, 50% 0%, 100% 100%);
  transition: transform 0.6s ease;
  z-index: 4;
}
.envelope-container.open .flap { transform: translateX(-50%) rotateX(0deg); }

.triangle-left, .triangle-right {
  position: absolute;
  border-top: 195px solid transparent;
  border-bottom: 100px solid transparent;
  top: 50%; transform: translateY(-50%);
  z-index: 3;
}
.triangle-left { border-right: 80px solid #800020; left: 73%; }
.triangle-right { border-left: 80px solid #800020; right: 73%; }
.bottom-rectangle { position: absolute; bottom: -1%; left: 0; width: 100%; height: 55px; background: #800020; z-index: 2; }

/* Card inside envelope */
.card {
  position: absolute;
  bottom: -120%;
  left: 50%;
  transform: translateX(-50%);
  width: 80%;
  height: 60%;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  transition: bottom 0.8s ease, opacity 0.4s ease;
  z-index: 1;
  padding: 10px;
  text-align: center;
  opacity: 0;
}
.envelope-container.open .card { bottom: 30%; opacity: 1; }

.read-btn {
  margin-top: 10px;
  padding: 8px 16px;
  background: #ff0000;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: transform 0.3s ease, background 0.3s ease;
}
.read-btn:hover { transform: scale(1.1); background: #cc0000; }

/* Main Paper */
.paper {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  width: 90%;
  max-width: 800px;
  max-height: 100%;
  background: #fff;
  box-shadow: 0 6px 25px rgba(0,0,0,0.4);
  padding: 40px;
  overflow-y: auto;
  transition: transform 0.6s ease;
  z-index: 1000;
  border-radius: 10px;
  line-height: 1.6;
  text-align: center;
}
.paper.show { transform: translate(-50%, -50%) scale(1); }
.close-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  background: #D8BFD8;
  color: white;
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  font-size: 18px;
  cursor: pointer;
}

/* Letter Circles inside Main Paper */
.letter-buttons {
  display: flex;
  justify-content: center;
  margin-top: 20px;
  gap: 20px;
}
.letter-btn {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: #800020;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  font-weight: bold;
  color: white;
  font-size: 18px;
  transition: transform 0.3s ease, background 0.3s ease;
}
.letter-btn:hover { transform: scale(1.3); background: #a00030; }

/* Individual Letters */
.letter-paper {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  width: 80%;
  max-width: 700px;
  max-height: 90%;
  background: #fff;
  box-shadow: 0 6px 25px rgba(0,0,0,0.4);
  padding: 30px;
  overflow-y: auto;
  transition: transform 0.6s ease;
  z-index: 1001;
  border-radius: 10px;
  line-height: 1.6;
  text-align: center;
}
.letter-paper.show { transform: translate(-50%, -50%) scale(1); }
.back-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  background: #D8BFD8;
  color: white;
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  font-size: 18px;
  cursor: pointer;
}

/* Floating Hearts (Background) */
.heart { 
  position: absolute; 
  pointer-events: none; 
  transform: translate(-50%, -50%); 
  user-select: none; 
  z-index: 0; 
  background-size: contain; 
  background-repeat: no-repeat; 
  filter: drop-shadow(0 0 2px rgba(255,0,0,0.6));
  transition: filter 0.2s ease;
}
</style>
</head>
<body>

<!-- Background Music for Main Paper -->
<audio id="bgMusic" src="here-with-me-by-d4vd-piano-cover.mp3" preload="auto" loop></audio>

<!-- Individual Audio for Letters -->
<audio id="letterAudio1" src="dandelions-piano-cover.mp3" preload="auto"></audio>
<audio id="letterAudio2" src="a-sky-full-of-stars-piano-cover.mp3" preload="auto"></audio>
<audio id="letterAudio3" src="coldplay-the-scientist-piano-cover.mp3" preload="auto"></audio>

<!-- Envelope & Card -->
<div class="envelope-container" id="envelope">
  <div class="envelope">
    <div class="triangle-left"></div>
    <div class="triangle-right"></div>
    <div class="bottom-rectangle"></div>
    <div class="flap"></div>
    <div class="card">
      <span><h3>To: Mary Louise T. Magno</h3></span>
      <button class="read-btn" id="readBtn">Read</button>
    </div>
  </div>
</div>

<!-- Main Paper -->
<div class="paper" id="paper">
  <button class="close-btn" id="closeBtn">ü•Ä</button>
  <div class="paper-content">
    <br>
    <br>
    <br>
    <h1>Happy Monthsary!</h1>
    
    <br>
    <p>Hello Love! <br> Sorry kung ito lang yung aking nakayanan.</p> 
    <p>Pero, I assure you naman na wala akong ginastos na pera para dito.</p> 
    <p>Kasi tulog ko lang naman ang na consume sa pag gawa ng page na 'to huhuhu.</p> 
    <br>
    <p>Anyway, sana magustohan mo 'tong page na ginawa ko para sa'yo. :3</p>
    <br>
    <p><i>P.S. sayang din yung bouquet na napag kasunduan namin ni trexie. </i></p> 
    <p>Surprise sana yun eh kung 'di n'ya sinabi aydi may 0.5k s'yaa.</p>
    <br>
  
    <div style="text-align: center;">
    <img src="teddy_bear_PNG14.png" alt="Description" width="150">
    </div>
    <p><i>P.S. tap mo yung mga bilog sa baba para mabasa mo yung mga letters ko sa'yo. </i></p>
    <p><i>-nat</i></p>

    <div class="letter-buttons">
      <div class="letter-btn" data-letter="1">1</div>
      <div class="letter-btn" data-letter="2">4</div>
      <div class="letter-btn" data-letter="3">3</div>
    </div>
  </div>
</div>

<!-- Individual Letters -->
<div class="letter-paper" id="letter1">
  <button class="back-btn">‚Üê</button>
  <h2>I</h2>
 
 
 
 
 <br>
    <div style="text-align: center;">
      <img src="Rose-Bouquet-PNG-Download-Image.png" alt="Description" width="150">
    </div>
    <br>
    <p>
      My Love,<br><br>
      I was really happy when I first met you in the plaza.<br>
      However, I didn‚Äôt just feel happy because you noticed the songs I was playing at that time.<br>
      The moment you came into my life, I felt peace.<br>
      Truly at peace, in a way I hadn‚Äôt felt in so long.<br>
      That moment, May 28, 2025, became a turning point for me.<br>
      <br>
      May itself was a difficult month, a month I really don't want to remember. <br>
      because I was carrying something from February until the end of the semester<br>
      Which was in the second week of May, and each day felt unbearable and sad.<br>
      But, I was able to be finally free, after trying to stitch myself back together from scratch<br>
      and after firmly severing ties with that person from my life.<br>
      Someone who left a trauma, because I kept getting nauseous every time I saw them.<br>
      <br>
      But then, in that month was you, there was you. <br>
      So it wasn't completely bad, and just by being there,<br>
      you brought color into my world.<br>
      You didn‚Äôt even realize it, <br>
      but that's okay since you made my life brighter in ways I cannot fully explain.<br>
      I thought my vacation would be nothing more than empty hours filled with games and movies,<br>
      but you changed all of that.<br>
      You brought the happiness that was lacking in my life,<br>
      where everything at that time felt dull.<br>
      You gave me a reason to look forward to the days again.<br>
      <br>
      Then came June, our birth month.<br>
      I‚Äôll never forget how your sister spoke to me about our engagement in-game.<br>
      It startled me, but at the same time, it filled me with a quiet joy.<br>
      That was when I realized just how deeply you had become my most favorite person‚Äî <br>
      the one I longed to talk to, the one whose presence brought me peace,<br>
      the one who turned simple days into cherished memories. <br>
      <br>
      I was already happy, but I wanted more.<br>
      I wanted to talk to you every single day,<br>
      to spend every moment I could by your side.<br>
      <br>
      And then, the most beautiful thing happened‚Äî<br>
      you became my girlfriend.<br>
      <div style="text-align: center;">
        <img src="510184375_2147565702417953_200733331725137905_n.jpg" alt="Description" width="250">
      </div>
      <br>
      That alone felt like a miracle to me.<br>
      You are so adorable, so wonderful, and cute <br>
      that you made me say things I never imagined myself capable of saying.<br>
      You pulled emotions out of me <br>
      I thought were gone forever.<br>
      And though it surprised me, it made me happy‚Äî<br>
      because finally, I could love someone so openly,<br>
      and express feelings that I don't have to kept hidden.<br>
      <br>
      Your presence is my peace.<br>
      That is why I never stop longing for it,<br>
      that's why I never stop longing for you.<br>
      <br>
      I won‚Äôt lie to you‚Äîsometimes I was afraid.<br>
      That fear made me stumble, even lie a few times.<br>
      And though you tell me I‚Äôm perfect, I know I am not. <br>
      I carry flaws, inconsistencies, and habits I‚Äôm not proud of.<br>
      <br>
      But know this: I am working on myself every day.<br>
      I am learning, I am changing,<br>
      because I want to love you better than I did.<br>
      I promise to take care of myself,<br>
      so that I never lose the chance to take care of you.<br>
      <br>
      You are my love, my peace, my happiness.<br>
      You are my home in a harsh world that feels unbearable.<br>
      <br>
      P.S. I miss you more than words will ever be able to say, po.<br>
      <br>
      Always yours,<br>
      ‚ÄîNat
    <br>
    <div style="text-align: center;">
      <img src="24001bc0-dce1-47d5-8f22-5e7a2fd3310a.jpg" alt="Description" width="100">
    </div>
    <br>
    </p>
</div>

<div class="letter-paper" id="letter2">
  <button class="back-btn">‚Üê</button>
  <h2>Love</h2>
 
<br>
    <p>
      Hello, my Love!!<br>
      <div style="text-align: center;">
        <img src="bef966458dfa918ef248bfc531ef7c2b.gif" alt="Description" width="150">
      </div>
      <br>
      <h2> Happy 3rd Monthsary to us! </h2>
      <br>
      How do you like my little pakulo this time?<br>
      I know it‚Äôs not much compared to the things<br>
      I wish I could give you, <br>
      but I poured my heart into this. <br>
      I really wanted to create something special for you‚Äî<br>
      something that would show, even in small ways, <br>
      just how much I love you.<br>
      To be honest, medyo naiinis din ako habang ginagawa ‚Äòto haha.<br>
      There were so many times na ‚Äòdi gumana yung mga gusto kong functions,<br>
      ang dami pang bugs na kailangan kong ayusin.<br>
      Pero habang ginagawa ko siya, I kept thinking of you‚Äî<br>
      and suddenly, kahit gaano kahirap, worth it lahat. <br>
      When I finally heard the audio playing, grabe‚Ä¶ napaiyak talaga ako.<br>
      Na-stuck ako for a while kasi hindi ko maituloy yung message.<br>
      It hit me so hard how much I love you, <br>
      and how much I want this to be perfect for you.<br>
      <br>
      I know this may not look grand, but I hope you can feel my sincerity.<br>
      I made sure to include all the colors you said you love, <br>
      because those small details matter to me.<br>
      Every little thing about you matters to me.<br>
      <br>
      We‚Äôve only been together for a short time‚Äî3 months pa lang‚Äî<br>
      but in those 3 months, you‚Äôve already changed so much in my life.<br>
      I can‚Äôt imagine how dull my days would be without you.<br>
      You‚Äôve filled my world with warmth, laughter, and meaning.<br>
      I wake up excited knowing I get to love you another day.<br>
      And I fall asleep every night missing you, hoping you‚Äôre sleeping well. <br>
      <br>
      I know you‚Äôre a very hardworking person.<br>
      You carry so much responsibility, and I admire that about you.<br>
      But at the same time, mahal, I worry about you a lot.<br>
      When you skip meals, when you lose sleep,<br>
      when you push yourself too hard‚Äî<br>
      I feel helpless,<br>
      kasi I just want to be there and take care of you.<br>
      So please, love, always remember: you don‚Äôt have to carry everything alone.<br>
      Take care of yourself.<br>
      Rest when you can.<br>
      I want to see you happy, healthy, and safe‚Äîalways.<br>
      <br>
      I also know that now, things are not as easy as before.<br>
      Our honeymoon phase has ended, <br>
      and the reality, especially the difficulty of our relationship, will start to show.<br>
      Misunderstandings, challenges, and hard days will keep on coming. <br>
      But that doesn‚Äôt scare me‚Äîbecause I believe in us.<br>
      I believe in what we have, in the love that we‚Äôve built together.<br>
      And I believe that no matter what obstacles we face,<br>
      as long as we hold on to each other, we‚Äôll make it through. <br>
      Love isn‚Äôt just about the butterflies‚Äîit‚Äôs about commitment. <br>
      It‚Äôs about choosing each other every single day,<br>
      even on the hard days, even when it isn‚Äôt easy.<br>
      And I choose you, always.<br>
      <div style="text-align: center;">
        <img src="love-cat.gif" alt="Description" width="150">
      </div>
      <br>
      I really want to be there for all the little things like‚Äî<br>
      sharing meals, watching movies, walking side by side‚Äî<br>
      and also for the big things‚Äî<br>
      celebrating milestones, facing hardships, and chasing dreams together.<br>
      <br>
      And someday, as we promised, I want to be the one waiting for you at the altar.<br>
      I want to be the one you walk toward,<br>
      the one who takes your hand and never lets it go again.<br>
      Because I don‚Äôt just love you for now‚Äî<br>
      I love you for forever.<br>
      I love you not only for who you are today,<br>
      but also for the person you‚Äôre becoming,<br>
      and for the future we‚Äôll build together.<br>
      <br>
      <div style="text-align: center;">
        <img src="icegif-331.gif" alt="Description" width="150">
      </div>
      These three months have been some of the happiest of my life.<br>
      And this is only the beginning.<br>
      There are so many more monthsaries, anniversaries, and memories to come.<br>
      I look forward to every single one of them,<br>
      because I get to spend them with you.<br>
      <br>
      Happy 3rd Monthsary, my Love.<br>
      You are my everything.<br>
      My love, my peace, my safe place.<br>
      <br>
      My LOML. My Mrs. ü•∫‚ù§Ô∏è<br>
      <br>
      Always and forever yours,<br>
      ‚ÄîNat<br>
  <div style="text-align: center;">
      <img src="13896a7fbb6752a1481b3adf95d1756b.gif" alt="Description" width="150">
    </div>
    </p>
</div>

<div class="letter-paper" id="letter3">
  <button class="back-btn">‚Üê</button>
  <h2>You</h2>
    <br>
    <div style="text-align: center;">
      <img src="539279597_24182017294830755_2487355796969750282_n.jpg" alt="Description" width="300">
    </div>
    <br>
    <p> My Love, <br><br>
      You really are beautiful.<br>
      Every time I see your pictures, or even just think that you're mine,<br>
      I feel like the luckiest man alive.<br>
      Sometimes I still wonder how I was able to pull someone like you into my life.<br>
      It feels like a blessing I‚Äôll never stop being grateful for.<br>
      <br>
      Yk when your friend sent that photo,<br>
      I couldn‚Äôt help but want to say thank you so badly.<br>
      Because seeing you, even just in a picture,<br>
      makes my whole day brighter.<br>
      But I held myself back‚Äîbecause I knew you might get upset if I did.<br>
      So instead, I just kept that feeling and let myself fall asleep,<br>
      because I had an on-the-spot activity again, and I didn't sleep the night before.<br>
      But with your image as the last thing on my mind. I was happy<br>
      <br>
      and I really want to hug my adorable girlfriend so bad! huhu<br>
      <br>
      I know you‚Äôve been very busy with school,<br>
      and as of now, we don‚Äôt always get to talk as much, and during the past weeks.<br>
      And I‚Äôm sorry, love‚Äîbecause I know that lately, <br>
      I haven‚Äôt been the best boyfriend.<br>
      I know I‚Äôve let my overthinking get the better of me.<br>
      I‚Äôve asked too many questions, worried too much,<br>
      and sometimes I‚Äôve put my own thoughts ahead of your feelings.<br>
      <br>
      But please know this: despite my flaws, despite my mistakes,<br>
      I truly care for you with all my heart.<br>
      I really, deeply, and unconditionally love you.<br>
      Even when I don‚Äôt express it properly,<br>
      even when I let my fears cloud my words,<br>
      my love for you never changes.<br>
      <br>
      Lately, I‚Äôve realized how much my overthinking affects us.<br>
      It‚Äôs not fair to you, and it‚Äôs not the kind of boyfriend I want to be.<br>
      I don‚Äôt want to let my doubts and fears take away the peace and happiness<br>
      that we both deserve in this relationship.<br>
      So I promise you‚ÄîI‚Äôm going to work on myself.<br>
      I want to be stronger, more mindful, and more present for you.<br>
      I want to give you the love you deserve, not the worries you don‚Äôt need.<br>
      <br>
      I want to be able to tell you more often how much you mean to me. <br>
      I want you to hear it from me, not just feel it in silence.<br>
      Because the truth is, you‚Äôre always on my mind.<br>
      Every little thing reminds me of you.<br>
      Every quiet moment, my thoughts drift back to you.<br>
      But I know I need to do more than just think of you‚Äî<br>
      I need to show you, remind you, and make you feel it every day.<br>
      <br>
      So I‚Äôm making a promise to you, my love:<br>
      I‚Äôll do my best to manage my overthinking,<br>
      to focus on building myself up so I can be a better partner for you.<br>
      Starting tomorrow, I‚Äôll be keeping myself busier,<br>
      diving into my own responsibilities and focusing on what I can control.<br>
      Sleep might end up being my only break,<br>
      but even then, I‚Äôll carry you in my thoughts.<br>
      And no matter how busy I become, I‚Äôll always make time for you.<br>
      <br>
      Because no matter what I do or where I am,<br>
      you are my priority.<br>
      You are my safe place, my happiness, my reason to push forward.<br>
      You are the one person I never want to lose.<br>
      <br>
      So please, always remember this:<br>
      I love you more than words will ever be able to capture.<br>
      I exist for you, I will always be here for you,<br>
      through the good days and the bad, through the calm and the chaos.<br>
      You are my love, my peace, my forever.<br>
      <br>
      And even if I fall short sometimes, even if I make mistakes,<br>
      my heart will always belong to you.<br>
      Always, and without question.<br>
      <br>
      Forever yours,<br>
      ‚ÄîNat<br>
    </p>
</div>

<script>
/* === Elements & audio === */
const envelope = document.getElementById("envelope"); // envelope container (id="envelope")
const readBtn = document.getElementById("readBtn");
const paper = document.getElementById("paper");
const closeBtn = document.getElementById("closeBtn");
const bgMusic = document.getElementById("bgMusic");

const letterAudios = {
  1: document.getElementById("letterAudio1"),
  2: document.getElementById("letterAudio2"),
  3: document.getElementById("letterAudio3")
};

/* === device detection === */
const isMobile = /Mobi|Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);

/* === Drag / Touch state === */
let isDragging = false;
let offsetX = 0, offsetY = 0;
let startX = 0, startY = 0;
let dragMoved = false;
let justDragged = false; // short cooldown after a drag to prevent accidental toggles

function clamp(val, min, max) { return Math.min(Math.max(val, min), max); }

/* -------------------------
   MOUSE drag handlers
   ------------------------- */
envelope.addEventListener("mousedown", (e) => {
  isDragging = true;
  dragMoved = false;
  envelope.style.transition = "none";
  startX = e.clientX; startY = e.clientY;
  const rect = envelope.getBoundingClientRect();
  offsetX = e.clientX - rect.left;
  offsetY = e.clientY - rect.top;
});

document.addEventListener("mousemove", (e) => {
  if (!isDragging) return;
  const dx = Math.abs(e.clientX - startX);
  const dy = Math.abs(e.clientY - startY);
  if (dx + dy > 4) dragMoved = true;
  let x = e.clientX - offsetX;
  let y = e.clientY - offsetY;
  x = clamp(x, 0, window.innerWidth - envelope.offsetWidth);
  y = clamp(y, 0, window.innerHeight - envelope.offsetHeight);
  envelope.style.left = x + "px";
  envelope.style.top = y + "px";
  // while dragging, cancel the centering transform so position is absolute
  envelope.style.transform = "translate(0, 0)";
});

document.addEventListener("mouseup", () => {
  if (!isDragging) return;
  isDragging = false;
  envelope.style.transition = "transform 0.4s ease, left 0.4s ease, top 0.4s ease";
  if (dragMoved) {
    justDragged = true;
    setTimeout(() => justDragged = false, 300);
  }
  dragMoved = false;
  if (!paper.classList.contains("show") && !document.querySelector(".letter-paper.show")) {
    envelope.style.left = '50%';
    envelope.style.top = '50%';
    envelope.style.transform = 'translate(-50%, -50%) scale(1)';
  }
});

/* -------------------------
   TOUCH drag handlers (mobile)
   - touchstart on envelope
   - touchmove & touchend on document
   ------------------------- */
envelope.addEventListener('touchstart', (e) => {
  const t = e.touches[0];
  isDragging = true;
  dragMoved = false;
  envelope.style.transition = "none";
  startX = t.clientX; startY = t.clientY;
  const rect = envelope.getBoundingClientRect();
  offsetX = t.clientX - rect.left;
  offsetY = t.clientY - rect.top;
  // do not preventDefault here so the browser can still handle non-drag gestures
}, { passive: true });

document.addEventListener('touchmove', (e) => {
  if (!isDragging) return;
  const t = e.touches[0];
  const dx = Math.abs(t.clientX - startX);
  const dy = Math.abs(t.clientY - startY);
  if (dx + dy > 4) {
    dragMoved = true;
    // while actually dragging, prevent scroll
    e.preventDefault();
  }
  let x = t.clientX - offsetX;
  let y = t.clientY - offsetY;
  x = clamp(x, 0, window.innerWidth - envelope.offsetWidth);
  y = clamp(y, 0, window.innerHeight - envelope.offsetHeight);
  envelope.style.left = x + "px";
  envelope.style.top = y + "px";
  envelope.style.transform = "translate(0, 0)";
}, { passive: false });

document.addEventListener('touchend', (e) => {
  // if we never started dragging on envelope, ignore
  if (!isDragging) return;
  isDragging = false;
  envelope.style.transition = "transform 0.4s ease, left 0.4s ease, top 0.4s ease";

  if (dragMoved) {
    // ended a drag
    justDragged = true;
    setTimeout(() => justDragged = false, 300);
    dragMoved = false;
    if (!paper.classList.contains("show") && !document.querySelector(".letter-paper.show")) {
      envelope.style.left = '50%';
      envelope.style.top = '50%';
      envelope.style.transform = 'translate(-50%, -50%) scale(1)';
    }
  } else {
    // it was a tap (touchstart + touchend with little movement)
    // toggle envelope (but avoid toggling if in justDragged state ‚Äî not relevant here but safe)
    if (!justDragged) toggleEnvelope();
  }
});

/* -------------------------
   Envelope toggle functions (kept)
   ------------------------- */
function toggleEnvelope() {
  if (isDragging || justDragged) return;
  if (envelope.classList.contains("open")) {
    if(!paper.classList.contains("show") && !document.querySelector(".letter-paper.show")) {
      envelope.classList.remove("open");
    }
  } else {
    envelope.classList.add("open");
  }
}

function openEnvelope() { if(!isDragging) envelope.classList.add("open"); }
function closeEnvelope() { if(!paper.classList.contains("show") && !document.querySelector(".letter-paper.show")) envelope.classList.remove("open"); }

/* -------------------------
   Desktop hover behavior (preserved)
   ------------------------- */
if (!isMobile) {
  envelope.addEventListener("mouseenter", openEnvelope);
  envelope.addEventListener("mouseleave", closeEnvelope);
}

/* -------------------------
   Audio + UI handlers (preserved)
   ------------------------- */
// Play main music on Read button
readBtn.addEventListener("click", () => {
  paper.classList.add("show");
  envelope.classList.add("open");
  stopAllAudios();
  bgMusic.currentTime = 0;
  bgMusic.play().catch(e => console.log(e));
});

// Close main paper
closeBtn.addEventListener("click", () => {
  paper.classList.remove("show");
  stopAllAudios();
  closeEnvelope();
});

// Letter buttons
document.querySelectorAll(".letter-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const letterId = "letter" + btn.dataset.letter;
    document.getElementById(letterId).classList.add("show");
    paper.classList.remove("show");
    envelope.classList.add("open");
    stopAllAudios();
    const audio = letterAudios[btn.dataset.letter];
    if (audio) { audio.currentTime = 0; audio.play().catch(e => console.log(e)); }
  });
});

// Back buttons
document.querySelectorAll(".back-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    btn.parentElement.classList.remove("show");
    paper.classList.add("show");
    stopAllAudios();
    bgMusic.currentTime = 0;
    bgMusic.play().catch(e => console.log(e));
  });
});

// Stop all audios (preserved)
function stopAllAudios(){
  bgMusic.pause();
  Object.values(letterAudios).forEach(a => { a.pause(); a.currentTime = 0; });
}

/* ------------------------------------------------------------------
   Optimized Floating Hearts (transform-based + fewer hearts on mobile)
   - Uses translate3d for GPU-friendly motion
   - FPS-independent movement (scaled by dt)
   ------------------------------------------------------------------ */

const colors = ["#FF0000", "#800020", "#00008B", "#98FB98", "#D8BFD8"];
let hearts = [];

// ensure hearts don't block pointer events (so envelope always receives taps)
let heartsContainer = document.querySelector('.hearts-container');
if (!heartsContainer) {
  heartsContainer = document.createElement('div');
  heartsContainer.className = 'hearts-container';
  heartsContainer.style.position = 'fixed';
  heartsContainer.style.left = '0';
  heartsContainer.style.top = '0';
  heartsContainer.style.width = '100%';
  heartsContainer.style.height = '100%';
  heartsContainer.style.pointerEvents = 'none';
  heartsContainer.style.overflow = 'hidden';
  heartsContainer.style.zIndex = '0';
  document.body.appendChild(heartsContainer);
}

function createHeart(color) {
  const heart = document.createElement("div");
  heart.className = "heart";
  const size = 10 + Math.random() * 20;
  heart.dataset.size = size;
  heart.dataset.color = color;
  heart._x = Math.random() * window.innerWidth;
  heart._y = -Math.random() * 200;
  heart.vy = 0.6 + Math.random() * 1.8;
  heart.style.width = (size) + 'px';
  heart.style.height = (size) + 'px';
  heart.style.backgroundImage = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 29"><path fill="${color.replace("#","%23")}" d="M23.6,0c-2.8,0-5.1,1.6-6.6,3.9C15.5,1.6,13.2,0,10.4,0C4.6,0,0,4.6,0,10.4c0,6.6,10.7,12.5,16,18.6c5.3-6.1,16-12,16-18.6C32,4.6,27.4,0,23.6,0z"/></svg>')`;
  heart.style.position = 'absolute';
  heart.style.left = '0px';
  heart.style.top = '0px';
  heart.style.transform = `translate3d(${Math.round(heart._x)}px, ${Math.round(heart._y)}px, 0) scale(${size/20})`;
  heart.style.willChange = 'transform, filter, opacity';
  heartsContainer.appendChild(heart);
  return heart;
}

const heartCount = isMobile ? 50 : 200;
for (let i = 0; i < heartCount; i++) {
  hearts.push(createHeart(colors[Math.floor(Math.random() * colors.length)]));
}

/* FPS-independent animation loop (stable on slow devices) */
let lastTime = performance.now();
function animateHearts(time) {
  const dt = Math.min(32, time - lastTime);
  lastTime = time;
  const open = envelope.classList.contains("open");
  for (let i = 0; i < hearts.length; i++) {
    const h = hearts[i];
    h._y += h.vy * (dt / 16); // scale by dt (16ms ~ 60fps)
    if (h._y > window.innerHeight + 50) {
      h._y = -50;
      h._x = Math.random() * window.innerWidth;
      h.vy = 0.6 + Math.random() * 1.8;
    }
    h.style.transform = `translate3d(${Math.round(h._x)}px, ${Math.round(h._y)}px, 0) scale(${h.dataset.size/20})`;
    if (open) {
      const glow = 2 + Math.sin(Date.now() / 300) * 6;
      h.style.filter = `drop-shadow(0 0 ${Math.round(glow)}px rgba(128,0,32,0.55))`;
      h.style.backgroundImage = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 29"><path fill="%23800020" d="M23.6,0c-2.8,0-5.1,1.6-6.6,3.9C15.5,1.6,13.2,0,10.4,0C4.6,0,0,4.6,0,10.4c0,6.6,10.7,12.5,16,18.6c5.3-6.1,16-12,16-18.6C32,4.6,27.4,0,23.6,0z"/></svg>')`;
    } else {
      h.style.filter = 'none';
      const color = h.dataset.color || colors[Math.floor(Math.random() * colors.length)];
      h.style.backgroundImage = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 29"><path fill="${color.replace("#","%23")}" d="M23.6,0c-2.8,0-5.1,1.6-6.6,3.9C15.5,1.6,13.2,0,10.4,0C4.6,0,0,4.6,0,10.4c0,6.6,10.7,12.5,16,18.6c5.3-6.1,16-12,16-18.6C32,4.6,27.4,0,23.6,0z"/></svg>')`;
    }
  }
  requestAnimationFrame(animateHearts);
}
requestAnimationFrame(animateHearts);
</script>
</body>
</html>






